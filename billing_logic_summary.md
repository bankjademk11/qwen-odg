# ສະຫຼຸບການແກ້ໄຂ Logic ການອອກບິນ POS (ສຳລັບລຸ້ນອ້າຍ)

## 1. ພາບລວມ Transaction: POS25090036

ເອກະສານສະບັບນີ້ສະຫຼຸບການປັບປຸງ Logic ການອອກບິນ POS ທີ່ໄດ້ດຳເນີນການໄປ, ໂດຍອ້າງອີງຈາກ Transaction ຕົວຢ່າງ: **POS25090036**.

*   **ເລກທີ່ບິນ (doc_no):** POS25090036
*   **ວັນທີ່:** 2025-09-23
*   **ລູກຄ້າ:** 2055758979
*   **ຍອດລວມ:** 56000.0 ₭
*   **ວິທີຊຳລະ:** ເງິນສົດ (Cash)

## 2. ການຈັດເກັບຂໍ້ມູນໃນແຕ່ລະຕາຕະລາງ

### 2.1. `ic_trans` (Inventory Transaction Header)

*   **ຈຸດປະສົງ:** ເກັບຂໍ້ມູນຫຼັກຂອງລາຍການເຄື່ອນໄຫວສິນຄ້າ.
*   **ຄໍລຳທີ່ສຳຄັນ ແລະ ຄ່າສຳລັບ POS25090036:**
    *   `trans_type`: `2` (ປັບປຸງຕາມຄຳແນະນຳ)
    *   `trans_flag`: `44`
    *   `doc_date`: `2025-09-23`
    *   `doc_no`: `POS25090036`
    *   `cust_code`: `2055758979`
    *   `branch_code`: `00` (ດຶງມາຈາກຂໍ້ມູນຜູ້ໃຊ້ທີ່ Login)
    *   `sale_code`: `25023` (ດຶງມາຈາກຂໍ້ມູນຜູ້ໃຊ້ທີ່ Login)
    *   `creator_code`: `25023` (ດຶງມາຈາກຂໍ້ມູນຜູ້ໃຊ້ທີ່ Login)
    *   `total_amount_2`: `56000.0` (**ໄດ້ແກ້ໄຂໃຫ້ຖືກຕ້ອງແລ້ວ**)

### 2.2. `ic_trans_detail` (Inventory Transaction Detail)

*   **ຈຸດປະສົງ:** ເກັບລາຍລະອຽດຂອງສິນຄ້າແຕ່ລະລາຍການໃນບິນ.
*   **ຄໍລຳທີ່ສຳຄັນ ແລະ ຄ່າສຳລັບ POS25090036 (ສຳລັບແຕ່ລະລາຍການສິນຄ້າ):**
    *   `trans_type`: `2` (ປັບປຸງຕາມຄຳແນະນຳ)
    *   `trans_flag`: `44`
    *   `doc_date`: `2025-09-23`
    *   `doc_no`: `POS25090036`
    *   `cust_code`: `2055758979`
    *   `inquiry_type`: `1` (ປັບປຸງຕາມຄຳແນະນຳ)
    *   `vat_type`: `2` (ປັບປຸງຕາມຄຳແນະນຳ)
    *   `branch_code`: `00` (ດຶງມາຈາກຂໍ້ມູນຜູ້ໃຊ້ທີ່ Login)
    *   `wh_code`: `1301` (ດຶງມາຈາກຂໍ້ມູນຜູ້ໃຊ້ທີ່ Login)
    *   `shelf_code`: `130101` (ດຶງມາຈາກຂໍ້ມູນຜູ້ໃຊ້ທີ່ Login)
    *   `sale_code`: `25023` (ດຶງມາຈາກຂໍ້ມູນຜູ້ໃຊ້ທີ່ Login)
    *   `creator_code`: `25023` (ດຶງມາຈາກຂໍ້ມູນຜູ້ໃຊ້ທີ່ Login)
    *   **`side_code`:** ບໍ່ໄດ້ຖືກ Insert (ຍັງບໍ່ມີຄໍລຳໃນ DB - ແກ້ໄຂຊົ່ວຄາວ)
    *   **`department_code`:** ບໍ່ໄດ້ຖືກ Insert (ຍັງບໍ່ມີຄໍລຳໃນ DB - ແກ້ໄຂຊົ່ວຄາວ)

### 2.3. `cb_trans` (Cash/Bank Transaction Header)

*   **ຈຸດປະສົງ:** ເກັບຂໍ້ມູນຫຼັກຂອງລາຍການເງິນສົດ/ທະນາຄານ.
*   **ຄໍລຳທີ່ສຳຄັນ ແລະ ຄ່າສຳລັບ POS25090036:**
    *   `trans_type`: `2`
    *   `trans_flag`: `44`
    *   `doc_date`: `2025-09-23`
    *   `doc_no`: `POS25090036`
    *   `total_amount`: `56000.0`
    *   `total_net_amount`: `56000.0`
    *   `cash_amount`: `56000.0` (**ໄດ້ແກ້ໄຂໃຫ້ຖືກຕ້ອງຕາມວິທີຊຳລະແລ້ວ**)
    *   `tranfer_amount`: `0.0` (**ໄດ້ແກ້ໄຂໃຫ້ຖືກຕ້ອງຕາມວິທີຊຳລະແລ້ວ**)
    *   `card_amount`: `0.0` (**ໄດ້ແກ້ໄຂໃຫ້ຖືກຕ້ອງຕາມວິທີຊຳລະແລ້ວ**)
    *   `ap_ar_code`: `2055758979`
    *   `pay_type`: `1`
    *   `doc_format_code`: `POS`

### 2.4. `cb_trans_detail` (Cash/Bank Transaction Detail)

*   **ຈຸດປະສົງ:** ເກັບລາຍລະອຽດຂອງລາຍການເງິນສົດ/ທະນາຄານ.
*   **ຄໍລຳທີ່ສຳຄັນ ແລະ ຄ່າສຳລັບ POS25090036:**
    *   `trans_type`: `2`
    *   `trans_flag`: `44`
    *   `doc_date`: `2025-09-23`
    *   `doc_no`: `POS25090036`
    *   `trans_number`: `POS25090036`
    *   `bank_code`: `NULL` (ຖືກຕ້ອງສຳລັບວິທີຊຳລະເງິນສົດ)
    *   `bank_branch`: `NULL` (ຖືກຕ້ອງສຳລັບວິທີຊຳລະເງິນສົດ)
    *   `exchange_rate`: `0.0015673`
    *   `amount`: `56000.0`
    *   `currency_code`: `02` (ເງິນກີບ)
    *   `sum_amount_2`: `87.76880000`

### 2.5. `ic_trans_shipment` (Inventory Transaction Shipment)

*   **ຈຸດປະສົງ:** ເກັບຂໍ້ມູນການຈັດສົ່ງສິນຄ້າ.
*   **ຄໍລຳທີ່ສຳຄັນ ແລະ ຄ່າສຳລັບ POS25090036:**
    *   `doc_no`: `POS25090036`
    *   `doc_date`: `2025-09-23`
    *   `cust_code`: `2055758979` (Map ມາຈາກ `customer_code`)
    *   `create_date_time_now`: `2025-09-23 09:58:58.929377`
    *   **`trans_flag`:** `0` (ຄ່າ Default ຈາກ DB) - **ຕ້ອງການການຢືນຢັນຈາກລຸ້ນອ້າຍວ່າຄ່າ `0` ນີ້ຖືກຕ້ອງສຳລັບ `ic_trans_shipment` ຫຼືບໍ່.**

## 3. ບັນຫາທີ່ພົບ ແລະ ການແກ້ໄຂ/ແກ້ໄຂຊົ່ວຄາວ

*   **`ic_trans.total_amount_2` ເປັນ `0.0`:**
    *   **ບັນຫາ:** ຄ່າ `total_amount_2` ບໍ່ຖືກບັນທຶກຢ່າງຖືກຕ້ອງ.
    *   **ການແກ້ໄຂ:** ໄດ້ເພີ່ມການແປງ Type ຂອງ `total_amount` ເປັນ `float` ຢ່າງຊັດເຈນກ່ອນ Insert.
*   **`ic_trans_detail.side_code` ແລະ `department_code` ບໍ່ມີຄໍລຳໃນ DB:**
    *   **ບັນຫາ:** ຖານຂໍ້ມູນບໍ່ມີຄໍລຳ `side_code` ແລະ `department_code` ຕາມທີ່ຕ້ອງການ.
    *   **ການແກ້ໄຂຊົ່ວຄາວ:** ໄດ້ນຳເອົາການ Insert ຄ່າສຳລັບສອງຄໍລຳນີ້ອອກຈາກ Code ຊົ່ວຄາວ ເພື່ອໃຫ້ Transaction ສາມາດສຳເລັດໄດ້.
    *   **ສິ່ງທີ່ຕ້ອງເຮັດຕໍ່:** ຕ້ອງເພີ່ມຄໍລຳ `side_code` ແລະ `department_code` ເຂົ້າໄປໃນຕາຕະລາງ `ic_trans_detail` ໃນຖານຂໍ້ມູນ.
*   **ຕາຕະລາງ `ic_trans_shipment` ບໍ່ມີໃນ DB / Schema ບໍ່ກົງກັນ:**
    *   **ບັນຫາ:** ຕາຕະລາງ `ic_trans_shipment` ບໍ່ມີໃນຖານຂໍ້ມູນໃນຕອນຕົ້ນ, ແລະເມື່ອພົບວ່າຕາຕະລາງມີຢູ່, Schema ຂອງມັນບໍ່ກົງກັບທີ່ຄາດໄວ້.
    *   **ການແກ້ໄຂ:** ໄດ້ປັບປຸງ `INSERT` statement ໃຫ້ກົງກັບ Schema ຕົວຈິງຂອງຕາຕະລາງ `ic_trans_shipment` ແລະໄດ້ເປີດໃຊ້ງານການ Insert ແລ້ວ.
*   **ການກຳນົດຄ່າຈຳນວນເງິນຊຳລະໃນ `cb_trans` ບໍ່ຖືກຕ້ອງ:**
    *   **ບັນຫາ:** `cash_amount`, `tranfer_amount`, `card_amount` ບໍ່ຖືກກຳນົດຕາມວິທີຊຳລະ.
    *   **ການແກ້ໄຂ:** ໄດ້ປັບປຸງ Logic ໃນ Code ເພື່ອກຳນົດຄ່າເຫຼົ່ານີ້ໃຫ້ຖືກຕ້ອງຕາມ `payment_method`.
*   **`ic_trans_shipment.trans_flag` ເປັນ `0`:**
    *   **ບັນຫາ:** ຄ່າ `trans_flag` ໃນ `ic_trans_shipment` ເປັນ `0` ໂດຍ Default.
    *   **ສິ່ງທີ່ຕ້ອງເຮັດຕໍ່:** ຕ້ອງການການຢືນຢັນຈາກລຸ້ນອ້າຍວ່າຄ່າ `0` ນີ້ຖືກຕ້ອງສຳລັບ `ic_trans_shipment` ຫຼືຄວນຈະເປັນຄ່າອື່ນ.

## 4. ສິ່ງທີ່ຕ້ອງເຮັດຕໍ່ໄປ (ການອັບເດດໂຄງສ້າງຖານຂໍ້ມູນ)

ເພື່ອໃຫ້ລະບົບເຮັດວຽກໄດ້ສົມບູນ 100% ຕາມຄວາມຕ້ອງການທັງໝົດ, ຕ້ອງມີການປັບປຸງໂຄງສ້າງຖານຂໍ້ມູນດັ່ງນີ້:

1.  **ເພີ່ມຄໍລຳ `side_code`** ເຂົ້າໄປໃນຕາຕະລາງ `ic_trans_detail`.
2.  **ເພີ່ມຄໍລຳ `department_code`** ເຂົ້າໄປໃນຕາຕະລາງ `ic_trans_detail`.

---

ຫວັງວ່າເອກະສານສະບັບນີ້ຈະຊ່ວຍໃຫ້ລຸ້ນອ້າຍເຂົ້າໃຈພາບລວມໄດ້ງ່າຍຂຶ້ນເດີ້!